<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>다피또</title>
  <style>
    @font-face {
      font-family: 'KyoboHand';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@1.0/KyoboHand.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }
    
    body {
      font-family: 'KyoboHand', sans-serif;
      background: url('https://i.postimg.cc/jSZVPRSf/ab18d062-812c-45da-b160-3dd7b3b36ddb.png') no-repeat center center fixed;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 60px;
    }
    h1 {
      font-size: 100px;
      font-weight: bold;
      color: #ffffffff;
      text-shadow: 
        -3px -3px 0 #000,  
        3px -3px 0 #000,  
        -3px 3px 0 #000,  
        3px 3px 0 #000;
    }
    .ticket {
      background: repeating-linear-gradient(
        45deg,
        #ffffff,
        #ffffff 10px,
        #fdf6d3 10px,
        #fdf6d3 20px
      );
      border: 6px dashed #ffca29;
      border-radius: 32px;
      padding: 61px 60px;
      width: 800px;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      position: relative;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .lucky-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 200px;
      margin-top: 35px;
    }
    .number-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      width: 580px;
    }
    .row {
      display: flex;
      justify-content: center;
      gap: 30px;
    }
    .lucky-label {
      font-weight: medium;
      font-size: 50px;
      color: #d35400;
      margin-bottom: 0px;
      margin-left: 6px;
    }
    .circle-container {
      position: relative;
      width: 125px;
      height: 125px;
      margin: 15px;
    }
    .number-label {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #ccc);
      border: 3px solid #999;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 45px;
      font-weight: bold;
      z-index: 0;
      user-select: none;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 125px;
      height: 125px;
      border-radius: 50%;
      z-index: 1;
    }
    .instruction {
      margin-top: 50px;
      font-size: 50px; /* 기존 24px → 더 큼 */
      text-align: center;
      font-weight: medium;
      color: #333;
    }
    .reset {
      margin-top: 40px;
    }
    .reset button {
      padding: 16px 32px;
      font-size: 25px;
      cursor: pointer;
      background-color: #ffffff;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
    }
    #result {
      margin-top: 30px;
      font-size: 28px;
      font-weight: bold;
    }
    .reset button:hover {
      background-color: #f1b400;
    }
    .spark-particle {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: radial-gradient(white, rgba(255, 215, 0, 0.8));
      pointer-events: none;
      opacity: 1;
      animation: particle-explode 0.8s ease-out forwards;
    }

    @keyframes particle-explode {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(var(--x), var(--y)) scale(0.5);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <h1>다 피 또</h1>
  <div class="ticket">
    <div class="lucky-section">
      <div class="lucky-label">행운숫자</div>
      <div id="lucky-container" class="circle-container"></div>
    </div>
    <div class="number-section">
      <div class="row" id="row1"></div>
      <div class="row" id="row2"></div>
    </div>
  </div>
  <div class="instruction">
    숫자 1 ~ 9 중 2개를 선택<br>행운숫자를 포함하여 2개를 모두 맞추면 성공!
  </div>
  <div class="reset">
    <button onclick="generateTicket()">다시 시작</button>
  </div>
  <div id="result"></div>

  <script>
    let ticketSet = [];
    let lucky;

    function scratchCanvas(canvas) {
      const ctx = canvas.getContext('2d');
      let isDrawing = false;

      function clear(e) {
        if (!isDrawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        ctx.globalCompositeOperation = 'destination-out';
        ctx.beginPath();
        ctx.arc(x, y, 15, 0, 2 * Math.PI);
        ctx.fill();

        const particleCount = 6 + Math.floor(Math.random() * 3);
        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement('div');
          particle.className = 'spark-particle';
          
          const angle = Math.random() * 2 * Math.PI;
          const distance = 20 + Math.random() * 20;
          const dx = Math.cos(angle) * distance;
          const dy = Math.sin(angle) * distance;

          particle.style.left = `${x}px`;
          particle.style.top = `${y}px`;
          particle.style.setProperty('--x', `${dx}px`);
          particle.style.setProperty('--y', `${dy}px`);

          canvas.parentElement.appendChild(particle);
          setTimeout(() => particle.remove(), 800);
        }
      }

      canvas.addEventListener('mousedown', () => isDrawing = true);
      window.addEventListener('mouseup', () => isDrawing = false);
      canvas.addEventListener('mousemove', clear);
    }

    function createScratchCircle(container, number) {
      container.innerHTML = '';
      const label = document.createElement('div');
      label.className = 'number-label';
      label.innerText = number;
      container.appendChild(label);

      const canvas = document.createElement('canvas');
      canvas.width = 125;
      canvas.height = 125;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#bbbbbb';
      ctx.beginPath();
      ctx.arc(65, 65, 65, 0, 2 * Math.PI);
      ctx.fill();

      container.appendChild(canvas);
      scratchCanvas(canvas);
    }

    function generateTicket() {
      document.getElementById("result").innerText = "";

      const fullSet = [...Array(9).keys()].map(x => x + 1);
      for (let i = fullSet.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [fullSet[i], fullSet[j]] = [fullSet[j], fullSet[i]];
      }

      ticketSet = fullSet.slice(0, 6);
      lucky = ticketSet[Math.floor(Math.random() * 6)];

      // lucky
      createScratchCircle(document.getElementById('lucky-container'), lucky);

      const filtered = ticketSet.filter(n => n !== lucky);
      const row1 = document.getElementById('row1');
      const row2 = document.getElementById('row2');
      row1.innerHTML = '';
      row2.innerHTML = '';

      filtered.forEach((num, idx) => {
        const wrap = document.createElement('div');
        wrap.className = 'circle-container';
        createScratchCircle(wrap, num);
        (idx < 3 ? row1 : row2).appendChild(wrap);
      });
    }

    generateTicket();
  </script>
</body>
</html>
