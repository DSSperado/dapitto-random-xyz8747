<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <title>다피또</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden; /* 스크롤 제거 */
    }
    .game-wrapper {
      position: relative;
      width: 2560px;   /* 기준 너비 */
      height: 1440px;  /* 기준 높이 */
      transform-origin: top center; /* 상단 기준으로 축소/확대 */
      padding: 60px;   /* 기존 body에 있던 내부 여백 이동 */
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
    }
    .background-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('https://i.postimg.cc/0QTt3Bgp/Kakao-Talk-20250806-233544689.png') no-repeat center center;
      background-size: 73%;
      z-index: -1;
    }
    @font-face {
      font-family: 'KyoboHand';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_20-04@1.0/KyoboHand.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }
    
    body {
      font-family: 'KyoboHand', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      font-size: 4.5vw;
      font-weight: 900;
      background: linear-gradient(45deg, #ff6ec4, #7873f5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      letter-spacing: 0.1em;
      margin-bottom: 30px;
      font-family: 'KyoboHand', sans-serif;
    }
    .ticket {
      background: url('https://i.postimg.cc/hGLCQ0Ns/Kakao-Talk-20250806-233544689-01.png') no-repeat center center;
      background-size: cover;
      padding: 61px 60px;
      width: 800px;
      margin-top: -10px;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      position: relative;
    }
    .lucky-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 200px;
      margin-top: 35px;
    }
    #lucky-container {
      margin-top: 0px;
      margin-left: -15px;
    }
    .number-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      width: 580px;
    }
    .row {
      display: flex;
      justify-content: center;
      gap: 30px;
    }
    .lucky-label {
      font-weight: 500;
      font-size: 50px;
      color: #ffffff;
      margin-bottom: 0px;
      margin-left: 6px;
    }
    .circle-container {
      position: relative;
      width: 125px;
      height: 125px;
      margin: 15px;
    }
    .circle-container.animate {
      animation: explodeAndReturn 0.8s ease;
    }

    @keyframes explodeAndReturn {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      30% {
        transform: translate(var(--rand-x), var(--rand-y)) scale(0.8);
        opacity: 0.6;
      }
      100% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
    }
    .number-label {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #cfcfcf 70%, #999999);
      box-shadow: inset -4px -4px 8px rgba(255,255,255,0.6),
                  inset 4px 4px 8px rgba(0,0,0,0.2),
                  0 4px 10px rgba(0,0,0,0.3);
      border: 3px solid #afaeae;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 45px;
      font-weight: bold;
      z-index: 0;
      user-select: none;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 125px;
      height: 125px;
      border-radius: 50%;
      z-index: 1;
    }
    .instruction {
      margin-top: 50px;
      font-size: 50px;
      text-align: center;
      font-weight: 500;
      color: #333;
    }
    .reset {
      margin-top: 40px;
    }
    .reset button {
      width: 120px;
      height: 120px;
      background-image: url('https://i.postimg.cc/HxbKxtf3/reset.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-color: transparent;
      border: none;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    #result {
      margin-top: 30px;
      font-size: 28px;
      font-weight: bold;
    }
    .reset button:hover {
      background-color: transparent;
      transform: scale(1.1);
    }
    .spark-particle {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: radial-gradient(white, rgba(255, 215, 0, 0.8));
      pointer-events: none;
      opacity: 1;
      animation: particle-explode 0.8s ease-out forwards;
    }

    @keyframes particle-explode {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(var(--x), var(--y)) scale(0.5);
        opacity: 0;
      }
    }
    #stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }
    .highlight-text {
      position: relative;
      display: inline-block;
      font-weight: 500;
      color: #333;
      z-index: 1;
    }

    .highlight-text::before {
      content: '';
      position: absolute;
      left: -5px;
      right: -5px;
      top: 50%;
      height: 1.4em;
      transform: translateY(-50%) rotate(-2deg);
      background: repeating-linear-gradient(
        -45deg,
        #fff38c,
        #fff38c 5px,
        #fff38c 5px,
        #fff38c 10px
      );
      z-index: -1;
      border-radius: 8px;
      opacity: 0.85;
    }
    @keyframes lucky-glow {
      0% {
        box-shadow: 0 0 0px rgba(255, 255, 100, 0.0);
      }
      50% {
        box-shadow: 0 0 60px 20px rgba(255, 255, 150, 0.8);
      }
      100% {
        box-shadow: 0 0 0px rgba(255, 255, 100, 0.0);
      }
    }
    .lucky-glow {
      box-shadow: 0 0 30px 10px rgba(255, 255, 150, 1);
      border-radius: 50%;
      transition: box-shadow 0.3s ease-in-out;
    }
    .canvas-container, 
    .circle-container, 
    .number-label {
      user-select: none;
      -webkit-user-select: none;
    }
    .instruction, .lucky-label, h1, #result {
      user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
      cursor: default;
    }

    @media (max-width: 768px) {
      body {
        padding: 4vw !important;
        justify-content: center;
      }
      h1 {
        font-size: 8vw !important;
        height: 8vw !important;
      }
      .ticket {
        width: 98vw !important;
        max-width: 98vw !important;
        min-width: 0 !important;
        padding: 4vw 1vw !important;
        flex-direction: column !important;
        align-items: center !important;
      }
      .lucky-section,
      .number-section {
        width: 100% !important;
        max-width: 100vw !important;
        align-items: center !important;
        margin: 0 auto !important;
        gap: 2vw !important;
      }
      .lucky-label {
        font-size: 5vw !important;
        margin-bottom: 1vw !important;
      }
      .circle-container {
        width: 16vw !important;
        height: 16vw !important;
        min-width: 50px !important;
        min-height: 50px !important;
        max-width: 70px !important;
        max-height: 70px !important;
        margin: 2vw !important;
      }
      .number-label {
        font-size: 6vw !important;
        min-font-size: 16px !important;
      }
      .row {
        gap: 2vw !important;
      }
      .instruction {
        font-size: 5vw !important;
        margin-top: 4vw !important;
      }
      .reset button {
        font-size: 4vw !important;
        padding: 2vw 7vw !important;
      }
    }

  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="background-layer"></div>
      <audio id="scratch-sound" src="pencil-scratch-30373.mp3" preload="auto"></audio>
      <audio id="shuffle-sound" src="mixkit-retro-game-notification-212.wav" preload="auto"></audio>
      <canvas id="stars"></canvas>
      <h1>다 피 또</h1>
      <div class="ticket">
        <div class="lucky-section">
          <div class="lucky-label">행운숫자</div>
          <div id="lucky-container" class="circle-container"></div>
        </div>
        <div class="number-section">
          <div class="row" id="row1"></div>
          <div class="row" id="row2"></div>
        </div>
      </div>
      <div class="instruction">
        <span class="highlight-text">숫자 1 ~ 9 중 2개를 선택</span><br>
        <span class="highlight-text">행운숫자를 포함하여 2개를 모두 맞추면 성공!</span>
      </div>
      <div class="reset">
        <button onclick="generateTicket()" title="reset"></button>
      </div>
      <div id="result"></div>
    </div>
  </div>
  
  <script>
    let currentScale = 1;
    
    function resizeGame() {
      const wrapper = document.querySelector('.game-wrapper');
      const scaleX = window.innerWidth  / 2560; // 기준 너비
      const scaleY = window.innerHeight / 1440; // 기준 높이
      
      const isMobile = /Mobi|Android/i.test(navigator.userAgent);
      const isPortrait = window.innerHeight > window.innerWidth;
      
      let scale;
      if (isMobile && isPortrait) {
        scale = scaleY * 1.05;
      } else {
        scale = Math.min(scaleX, scaleY) * 1.1;
      }

      currentScale = scale;
      wrapper.style.transform = `scale(${scale})`;
    }
    window.addEventListener('resize', resizeGame);
    resizeGame();

    let ticketSet = [];
    let lucky;

    function scratchCanvas(canvas, isLucky) {
      const ctx = canvas.getContext('2d');
      let isDrawing = false;

      const sound = document.getElementById('scratch-sound');
      sound.loop = false;
      sound.volume = 1.0;
      
      function clear(e) {
        if (!isDrawing) return;

        const rect = canvas.getBoundingClientRect();
        let xCss, yCss;
        if (e.touches && e.touches.length > 0) {
          xCss = e.touches[0].clientX - rect.left;
          yCss = e.touches[0].clientY - rect.top;
        } else {
          xCss = e.clientX - rect.left;
          yCss = e.clientY - rect.top;
        }
        const x = xCss / currentScale;
        const y = yCss / currentScale;
        
        const brushCss = window.innerHeight * 0.015;
        const r = brushCss / currentScale;    

        ctx.globalCompositeOperation = 'destination-out';
        ctx.beginPath();
        ctx.arc(x, y, r, 0, 2 * Math.PI);
        ctx.fill();

        const particleCount = 3 + Math.floor(Math.random() * 2);
        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement('div');
          particle.className = 'spark-particle';
          
          const angle = Math.random() * 2 * Math.PI;
          const distance = (40 + Math.random() * 20) / currentScale;
          const dx = Math.cos(angle) * distance;
          const dy = Math.sin(angle) * distance;

          particle.style.left = `${xCss}px`;
          particle.style.top  = `${yCss}px`;
          particle.style.setProperty('--x', `${dx}px`);
          particle.style.setProperty('--y', `${dy}px`);

          canvas.parentElement.appendChild(particle);
          setTimeout(() => particle.remove(), 800);
        }
        
        if (isLucky) {
          const label = canvas.parentElement.querySelector('.number-label');
          void canvas.offsetWidth;
          canvas.classList.add("lucky-glow");
        }
      }

      canvas.addEventListener('touchstart', (e) => {
        isDrawing = true;
        sound.currentTime = 0;
        sound.play().catch(() => {});
        e.preventDefault();
      }, {passive: false});

      window.addEventListener('touchend', () => {
        isDrawing = false;
        sound.pause();
        sound.currentTime = 0;
      }, {passive: false});

      canvas.addEventListener('touchmove', (e) => {
        if (!isDrawing) return;
        clear(e);
        e.preventDefault();
      }, {passive: false});

      canvas.addEventListener('mousedown', () => {
        if (!isDrawing) {
          isDrawing = true;
          sound.currentTime = 0;
          sound.play().catch(() => {});
        }
      });

      window.addEventListener('mouseup', () => {
        isDrawing = false;
        sound.pause();
        sound.currentTime = 0;
      });

      canvas.addEventListener('mousemove', clear);
    }
    function playShuffleSound() {
      const shuffleSound = document.getElementById('shuffle-sound');
      shuffleSound.currentTime = 0;
      shuffleSound.play();
    }
    function createScratchCircle(container, number, isLucky = false) {
      container.innerHTML = '';
      const label = document.createElement('div');
      label.className = 'number-label';
      label.innerText = number;
      container.appendChild(label);

      const canvas = document.createElement('canvas');
      canvas.width = 125;
      canvas.height = 125;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#bbbbbb';
      ctx.beginPath();
      ctx.arc(65, 65, 65, 0, 2 * Math.PI);
      ctx.fill();

      drawTexture(ctx);

      container.appendChild(canvas);
      scratchCanvas(canvas, isLucky);
    }

    function drawTexture(ctx) {
      const width = ctx.canvas.width;
      const height = ctx.canvas.height;
      
      for (let i = 0; i < 1000; i++) {
        const x = Math.random() * width;
        const y = Math.random() * height;
        const gray = Math.floor(Math.random() * 60 + 180);
        ctx.fillStyle = `rgb(${gray},${gray},${gray})`;
        ctx.fillRect(x, y, 1, 1);
      }
    }
    let isShuffling = false;
    
    function generateTicket() {
    playShuffleSound();
    
      if (isShuffling) return;
      isShuffling = true;
      
      const shuffleButton = document.querySelector('.reset button');
      shuffleButton.disabled = true;
      
      document.getElementById("result").innerText = "";
      const fullSet = [...Array(9).keys()].map(x => x + 1);
      for (let i = fullSet.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [fullSet[i], fullSet[j]] = [fullSet[j], fullSet[i]];
      }

      ticketSet = fullSet.slice(0, 6);
      const luckyIndex = Math.floor(Math.random() * 6);
      lucky = ticketSet[luckyIndex];

      const luckyContainer = document.getElementById('lucky-container');
      const row1 = document.getElementById('row1');
      const row2 = document.getElementById('row2');
      luckyContainer.innerHTML = '';
      row1.innerHTML = '';
      row2.innerHTML = '';

      const containers = [];
      
      ticketSet.forEach((num, idx) => {
        const wrap = document.createElement('div');
        wrap.className = 'circle-container';
        createScratchCircle(wrap, num, num === lucky);
        containers.push(wrap);
        if (idx === luckyIndex) {
          luckyContainer.appendChild(wrap);
        } else {
          (row1.children.length < 3 ? row1 : row2).appendChild(wrap);
        }
      });

      setTimeout(() => {
        const rects = containers.map(el => el.getBoundingClientRect());
        const positions = rects.map(r => ({ x: r.left, y: r.top }));
        const indices = containers.map((_, i) => i);
        indices.sort(() => Math.random() - 0.5);

        indices.forEach((i, idx) => {
          const from = positions[i];
          const to = positions[idx];
          const dx = (to.x - from.x) / currentScale;
          const dy = (to.y - from.y) / currentScale;
          containers[i].style.transition = 'transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55)';
          containers[i].style.transform = `translate(${dx}px, ${dy}px) scale(1.1)`;
          setTimeout(() => {
            containers[i].style.transition += ', transform 0.2s ease';
            containers[i].style.transform = `translate(${dx}px, ${dy}px) scale(1)`;
          }, 50);
        });

        setTimeout(() => {
          const reordered = indices.map(i => containers[i]);
          row1.innerHTML = '';
          row2.innerHTML = '';
          luckyContainer.innerHTML = '';

          reordered.forEach((wrap) => {
            wrap.style.transform = 'translate(0, 0)';
            const label = wrap.querySelector('.number-label');
            const canvas = wrap.querySelector('canvas');
            const number = parseInt(label.innerText);
            const isLuckyCanvas = number === lucky;

            if (isLuckyCanvas) {
              luckyContainer.appendChild(wrap);
            } else {
              (row1.children.length < 3 ? row1 : row2).appendChild(wrap);
            }

            scratchCanvas(canvas, isLuckyCanvas);
          });
          
          shuffleButton.disabled = false;
          isShuffling = false;
        }, 200);
      });
    }

    function createStarsCanvas() {
      const canvas = document.getElementById("stars");
      const ctx = canvas.getContext("2d");

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      const stars = Array.from({ length: 250 }, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 2 + 1,
        alpha: Math.random(),
        delta: Math.random() * 0.02
      }));

      function drawStars() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        stars.forEach(star => {
          star.alpha += star.delta;
          if (star.alpha <= 0 || star.alpha >= 1) star.delta *= -1;

          ctx.beginPath();
          ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(255, 255, 255, ${star.alpha})`;
          ctx.fill();
        });
        requestAnimationFrame(drawStars);
      }

      drawStars();
    }

    createStarsCanvas();
    generateTicket();

  </script>
</body>
</html>
